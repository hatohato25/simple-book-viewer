# 電子書籍ビューア

ブラウザで利用できるシンプルな電子書籍ビューアー。画像ファイル、PDF、EPUB、ZIPファイルを見開き表示できます。

## [DEMO](https://hatohato25.github.io/simple-book-viewer/)
<img width="1668" height="1293" alt="スクリーンショット 2025-10-17 3 38 05" src="https://github.com/user-attachments/assets/e0acf720-520c-49f8-acf2-b4ba96f0325f" style="width: 40%;" />
<img width="1655" height="1289" alt="スクリーンショット 2025-10-17 3 42 02" src="https://github.com/user-attachments/assets/9fe346db-04ec-4a8d-b91c-135702ca3abf" style="width: 40%;" />


## 機能

### 📖 表示機能
- **見開き表示**: 2ページを並べて表示
  - 画像ファイル: 右→左の読み順（漫画形式）
  - PDFファイル: 左→右の読み順（書籍形式）
- **見開き調整**: ページのズレを調整するボタン
- **最大化表示**: フルスクリーンモードで没入感のある読書体験
- **サムネイル表示**: 全ページをグリッド表示し、目的のページへ素早くジャンプ

### 🎮 操作機能
- **ページ操作**: クリック領域、シークバー、キーボード、マウスホイールでページ送り/戻り
- **タッチジェスチャー**: スワイプでページ送り、ピンチズームで拡大縮小（モバイル対応）
- **ブックマーク**: 現在のページ位置を保存し、次回開いた時に続きから読める
- **最近読んだファイル**: 履歴から素早く再アクセス（最大10件、自動保存）

### 📁 対応形式
- **画像**: JPG, JPEG, PNG, GIF, WebP, AVIF
- **ドキュメント**: PDF, EPUB
- **アーカイブ**: ZIP（画像ファイルを含むZIPを自動展開）

### ⚡ その他
- **自然順ソート**: ファイル名の数字を正しく認識してソート（page1, page2, page10...）
- **レスポンシブ**: PC・タブレット・スマートフォン対応
- **フォルダドロップ対応**: フォルダをそのままドロップ可能
- **ローディング表示**: ファイル読み込み中のアニメーション表示
- **ファイル履歴**: IndexedDBでファイル全体を保存、ファイル移動後も再読込可能

## 使い方

### 1. ローカルサーバーを起動

```bash
npm install
npm start
```

ブラウザが自動的に開きます（http://localhost:8080）

**重要**: ファイル直接開き（file://）では動作しません。必ずローカルサーバー経由でアクセスしてください。

### 2. ファイルを読み込む

#### 最近読んだファイルから開く
1. ブラウザを開くと、最近読んだファイルの履歴が表示されます
2. 履歴カードをクリックすると、前回の続きから読書を再開できます
3. 「×」ボタンで個別削除、「全クリア」ボタンで全履歴を削除できます

#### ドロップゾーンをクリックして開く
1. ドロップゾーンをクリックすると**ファイル選択モーダル**が表示されます
2. モーダルから選択できる読み込み方法：
   - **「ファイルを選択」**: PDF、EPUB、ZIP、画像ファイル（複数選択可）
   - **「フォルダを選択」**: 画像が入ったフォルダを直接選択
3. 選択後、自動的にファイルが読み込まれます

#### ドラッグ&ドロップで開く
以下の方法でも読み込めます：

**画像ファイルの場合**
1. Finderまたはエクスプローラーで画像フォルダを開く
2. **フォルダをそのままドロップ**、または
3. **Ctrl+A**（Windows）または**Cmd+A**（Mac）でフォルダ内の全ファイルを選択してドロップ

**PDFファイルの場合**
1. PDFファイルをブラウザのドロップゾーンにドラッグ&ドロップ

**ZIPファイルの場合**
1. 画像ファイルを含むZIPファイルをブラウザのドロップゾーンにドラッグ&ドロップ
2. ZIPファイルが自動的に展開され、画像が表示されます

**EPUBファイルの場合**
1. EPUBファイルをブラウザのドロップゾーンにドラッグ&ドロップ
2. EPUB内の画像が自動的に抽出され、表示されます

### 3. ページ操作

- **クリック領域**: 画面左右をクリックしてページ移動
- **キーボード**:
  - 画像/EPUB: **←キー**（次）/ **→キー**（前）
  - PDF: **→キー**（次）/ **←キー**（前）
- **マウスホイール**: 下に回すと次ページ、上に回すと前ページ
- **タッチジェスチャー**（スマートフォン・タブレット）:
  - **スワイプ**: 左右にスワイプしてページ移動
  - **ピンチズーム**: 2本指でピンチ操作して拡大縮小（1倍〜3倍）
- **シークバー**: 下部のシークバーで任意のページにジャンプ
- **見開き調整**: 下部の「見開き調整」ボタンでページのズレを修正
- **最大化表示**: 下部の「⛶」ボタンでフルスクリーン表示
- **ブックマーク**: 下部のリボンアイコンで現在のページを保存
- **サムネイル**: 下部のグリッドアイコンで全ページ一覧を表示
- **リセット**: 上部の「閉じる」ボタンで別のファイルを読み込む

## 開発

### コマンド

```bash
# ローカルサーバー起動
npm start

# テスト実行
npm test

# テスト（監視モード）
npm run test:watch

# テストUI
npm run test:ui

# コードフォーマット
npm run format

# Lint
npm run lint
```

### プロジェクト構成

```
book-viewer/
├── index.html          # メインHTML
├── style.css           # スタイルシート
├── js/                # JavaScriptモジュール
│   ├── state.js       # 状態管理・LocalStorage
│   ├── utils.js       # ユーティリティ関数
│   ├── fileHistory.js # ファイル履歴管理（IndexedDB）
│   ├── recentFiles.js # 履歴UI管理
│   ├── imageViewer.js # 画像ビューア（RTL）
│   ├── pdfViewer.js   # PDFビューア（LTR）
│   ├── thumbnail.js   # サムネイル表示機能
│   ├── touchGestures.js # タッチジェスチャー機能
│   └── app.js         # メインコントローラー
├── tests/             # ユニットテスト
│   └── app.test.js
├── .claude/           # プロジェクト管理
│   ├── requirements.md
│   ├── design.md
│   └── future-features.md
├── package.json
└── README.md
```

### アーキテクチャ

#### モジュール構成

- **state.js**: アプリケーション状態とDOM要素の管理、ブックマーク機能（LocalStorage）
- **utils.js**: ファイル処理、ソート、ファイルタイプ判定などのユーティリティ
- **fileHistory.js**: ファイル履歴管理（IndexedDB）、Blob保存/読み込み
- **recentFiles.js**: 履歴UI管理、カード生成、イベント処理
- **imageViewer.js**: 画像ファイル用のビューアロジック（右→左読み）
- **pdfViewer.js**: PDFファイル用のビューアロジック（左→右読み）
- **thumbnail.js**: サムネイル表示、ページジャンプ、ホイールイベント制御
- **touchGestures.js**: タッチジェスチャー機能（スワイプ、ピンチズーム）
- **app.js**: メインコントローラー、ファイルタイプ判定と振り分け

#### イベント管理

各ビューア（imageViewer/pdfViewer）は独立したイベントリスナーを持ち、ファイルタイプに応じて動的に登録・削除されます。これにより、画像とPDFで異なる操作性を実現しています。

#### データ永続化

- **ブックマーク**: LocalStorageにファイルごとの読書位置を保存
- **ファイル履歴**: IndexedDBにファイル全体をBlob形式で保存（最大10件）
- **ファイル識別**: ファイル名+サイズ+更新日時からハッシュを生成して同一ファイルを識別

## 技術スタック

- **フロントエンド**: Vanilla JavaScript (ES6+)
- **スタイル**: CSS3
- **PDF表示**: PDF.js v3.11.174 (CDN)
- **ZIP展開**: JSZip v3.10.1 (CDN)
- **テスト**: Vitest + happy-dom
- **Lint/Format**: Biome
- **開発サーバー**: http-server

## ブラウザ対応

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## トラブルシューティング

### 画像が表示されない

- **原因**: file://プロトコルで開いている
- **解決**: `npm start`でローカルサーバーを起動してください

### PDFが表示されない

- **原因**: ネットワーク接続がない（PDF.jsがCDNから読み込めない）
- **解決**: インターネット接続を確認してください

### ページが正しく並ばない

- **原因**: ファイル名のソート順が不適切
- **解決**: ファイル名を`page001.jpg`, `page002.jpg`のように統一してください

### 見開きがズレている

- **原因**: 表紙などで奇数ページから始まっている
- **解決**: 下部の「見開き調整」ボタンをクリックしてズレを修正してください

### ZIPファイルが展開されない

- **原因**: ネットワーク接続がない（JSZipがCDNから読み込めない）
- **解決**: インターネット接続を確認してください

### ZIPファイル内に画像が表示されない

- **原因**: ZIPファイル内に画像ファイルが含まれていない
- **解決**: JPG, PNG, GIF, WebP, AVIFのいずれかの形式の画像ファイルを含むZIPファイルを使用してください

## デバッグ

開発者ツール（F12）のConsoleタブを開くと、詳細なログが表示されます：

- `[Init]`: 初期化処理
- `[Drop]`: ファイルドロップ
- `[Collect]`: ファイル収集
- `[ZIP]`: ZIP展開処理
- `[EPUB]`: EPUB展開処理
- `[Load]`: 画像読み込み
- `[Display]`: ページ表示
- `[Navigate]`: ページ遷移
- `[PDF]`: PDF処理
- `[Bookmark]`: ブックマーク保存/読み込み

## ライセンス

MIT License
